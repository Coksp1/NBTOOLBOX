function makeGUI(gui)
% Syntax:
%
% makeGUI(gui)
%
% Description:
%
% Part of DAG.
% 
% Generates a window where the user can either import an excel sheet 
% directly or customize. Creates an import window for excel sheets,  
% with seperate panels for advanced and simple imports. 
% 
% Written by Eyo I. Herstad and Kenneth Sæterhagen Paulsen

% Copyright (c) 2024, Kenneth Sæterhagen Paulsen

    % Create Window
    %--------------------------------------------------------------
    gui.figureHandle = nb_guiFigure(gui.parent,gui.figureName,[50 40 130 40],'modal','off');
    pos              = get(gui.figureHandle,'position');
    pos(1)           = 0;
    pos(2)           = 0;
    
    % Create panel for intial and advanced selection    
    %--------------------------------------------------------------
    gui.initSelectPanel = uipanel(...
                'visible',      'on',...
                'parent',       gui.figureHandle,...
                'units',        'characters',...
                'position',     pos,...
                'borderType',   'none',...
                'title',        '');
            
          
    gui.advSelectPanel = uipanel(...
                'visible',      'off',...
                'parent',       gui.figureHandle,...
                'units',        'characters',...
                'position',     pos,...
                'borderType',   'none',...
                'title',        '');
            
    % Set current panel
    gui.currentPanel = gui.initSelectPanel;
            
    % Populate initial panel
    %--------------------------------------------------------------
    
    % Create table    
    gui.initTable = uitable(gui.initSelectPanel,...
        'units',     'normalized',...
        'position',  [0.05 0.15 0.9 0.65]);
    
    % Positions    
    Height = 0.05;
    Width = 0.15;
    textWidth = 0.18;
    space = 0.1;
    xStart = (1 - Width*3 - space*2)/2;
    ySpace = 0.05;
    
    % Sheet selection
    uicontrol(gui.initSelectPanel,...
                            'style',                'text',...
                            'units',                'normalized',...
                            'position',             [space, 1-ySpace-Height-0.01, textWidth, Height],...
                            'string',               'Select Sheet to import:',...
                            'horizontalAlignment',  'left');
                        
    gui.initSheetSelectBox = uicontrol(gui.initSelectPanel,...
                            'style',                'popupmenu',...
                            'units',                'normalized',...
                            'position',             [space+textWidth, 1-ySpace-Height, Width, Height],...
                            'background',           [1 1 1],...
                            'string',               gui.sheetList,...
                            'callback',             @gui.selectBoxCallback,...
                            'horizontalAlignment',  'left');

    % Sort
    gui.sortButton = uicontrol(gui.initSelectPanel,...
                            'style',                'radiobutton',...
                            'units',                'normalized',...
                            'position',             [space + textWidth + Width + 0.06, 1-ySpace-Height, Width, Height],...
                            'string',               'Sort',...
                            'value',                0,...
                            'horizontalAlignment',  'left');                    

    % Force nb_cell
    gui.nb_cellButton = uicontrol(gui.initSelectPanel,...
                            'style',                'radiobutton',...
                            'units',                'normalized',...
                            'position',             [space*2 + textWidth + Width + 0.06*2, 1-ySpace-Height, Width, Height],...
                            'string',               'Force cell object',...
                            'value',                0,...
                            'horizontalAlignment',  'left');                        
                        
    % Buttons    
    uicontrol(gui.initSelectPanel,...
                     'units',       'normalized',...
                     'position',    [xStart,ySpace,Width,Height],...
                     'callback',    @gui.exitGUI,...
                     'String',      'Cancel',...
                     'Style',       'pushbutton');

    uicontrol(gui.initSelectPanel,...
                     'units',       'normalized',...
                     'position',    [xStart + Width + space,ySpace,Width,Height],...
                     'callback',    @gui.switchImportPanel,...
                     'String',      'Next',...
                     'Style',       'pushbutton');
                 
    uicontrol(gui.initSelectPanel,...
                     'units',       'normalized',...
                     'position',    [xStart + Width*2 + space*2,ySpace,Width,Height],...
                     'callback',    @gui.finishCallback,...
                     'String',      'Finish',...
                     'Style',       'pushbutton');  
                 
    % Populate advanced panel
    %--------------------------------------------------------------
    % Create table
    gui.advTable = uitable(gui.advSelectPanel,...
        'units',     'normalized',...
        'position',  [0.05 0.15 0.9 0.5]);
    
    % Position values
    ySpace  = 0.08; 
    xSpace  = 0.05;
    pWidth   = 0.32;
    textWidth = 0.2;
    textWidthS = 0.1;
    textHeight = 0.15;
    pHeight  = 0.15;
    textStart = xSpace+pWidth+5*xSpace;
    boxStart = textStart+textWidth+0.01;
    boxStartS = xSpace + textWidthS + 0.01;
    buttonClearing = 0.05;
    
    % Create options panel    
    optionsPanel = uipanel(gui.advSelectPanel,...
                            'units',                'normalized',...
                            'position',             [0.05 0.7 0.9 0.25],...
                            'title',                'Options');
    
    gui.customSpec          = uicontrol(optionsPanel,...
                            'style',                'radiobutton',...
                            'units',                'normalized',...
                            'position',             [xSpace 1-ySpace-pHeight pWidth pHeight],...
                            'callback',             @gui.importRadioCallback,...
                            'value',                0,...
                            'string',               'Activate/deactivate custom import:');
    
    gui.transposeButton     = uicontrol(optionsPanel,...
                            'style',                'checkbox',...
                            'units',                'normalized',...
                            'position',             [xSpace 1-3*ySpace-3*pHeight pWidth pHeight],...
                            'enable',               'off',...
                            'String',               'Read by row (transpose)',...
                            'callback',             @gui.transposeCallback,...
                            'horizontalAlignment',  'left');
   gui.sortButtonAdv        = uicontrol(optionsPanel,...
                            'style',                'checkbox',...
                            'units',                'normalized',...
                            'position',             [xSpace 1-4*ySpace-4*pHeight pWidth pHeight],...
                            'String',               'Sort',...
                            'value',                0,...
                            'horizontalAlignment',  'left');                     
                        
   uicontrol(optionsPanel,...
                            'style',                'text',...
                            'units',                'normalized',...
                            'position',             [xSpace 1-2*ySpace-2*pHeight textWidthS textHeight],...
                            'string',               'Sheet:',...
                            'horizontalAlignment',  'left');
   gui.advSheetSelectBox   = uicontrol(optionsPanel,...
                            'style',                'popupmenu',...
                            'units',                'normalized',...
                            'position',             [boxStartS 1-2*ySpace-2*pHeight Width pHeight],...
                            'enable',               'off',...
                            'background',           [1 1 1],...
                            'string',               gui.sheetList,...
                            'callback',             @gui.selectBoxCallback,...
                            'horizontalAlignment',  'left');
                        
   uicontrol(optionsPanel,...
                            'style',                'text',...
                            'units',                'normalized',...
                            'position',             [textStart-Width-xSpace 1-ySpace-pHeight textWidth textHeight],...
                            'string',               'New name of dataset:',...
                            'horizontalAlignment',  'left');                    
                        
    gui.nameBox             = uicontrol(optionsPanel,...
                            'style',                'edit',...
                            'units',                'normalized',...
                            'position',             [textStart-Width-xSpace 1-2*ySpace-pHeight-0.02 Width pHeight],...
                            'enable',               'off',...
                            'background',           [1 1 1],...
                            'string',               '',...
                            'horizontalAlignment',  'left');
    uicontrol(optionsPanel,...
                            'style',                'text',...
                            'units',                'normalized',...
                            'position',             [textStart 1-ySpace-pHeight textWidth textHeight],...
                            'string',               'Select obs/dates/types',...
                            'horizontalAlignment',  'right');
                        
    gui.dateSelectBox       = uicontrol(optionsPanel,...
                            'style',                'edit',...
                            'units',                'normalized',...
                            'position',             [boxStart 1-ySpace-pHeight Width pHeight],...
                            'background',           [1 1 1],...
                            'enable',               'off',...
                            'String',               '',...
                            'horizontalAlignment',  'left');
                        
    uicontrol(optionsPanel,...
                            'style',                'text',...
                            'units',                'normalized',...
                            'position',             [textStart 1-2*ySpace-2*pHeight textWidth textHeight],...
                            'string',               'Select variables',...
                            'horizontalAlignment',  'right');
                        
    gui.varSelectBox        = uicontrol(optionsPanel,...
                            'style',                'edit',...
                            'units',                'normalized',...
                            'position',             [boxStart 1-2*ySpace-2*pHeight Width pHeight],...
                            'enable',               'off',...
                            'background',           [1 1 1],...
                            'string',               '',...
                            'horizontalAlignment',  'left');
    
    uicontrol(optionsPanel,...
                            'style',                'text',...
                            'units',                'normalized',...
                            'position',             [textStart 1-3*ySpace-3*pHeight textWidth textHeight],...
                            'string',               'Select data',...
                            'horizontalAlignment',  'right');
    
    gui.dataSelectBox       = uicontrol(optionsPanel,...
                            'style',                'edit',...
                            'units',                'normalized',...
                            'position',             [boxStart 1-3*ySpace-3*pHeight Width pHeight],...
                            'enable',               'off',...
                            'background',           [1 1 1],...
                            'string',               '',...
                            'horizontalAlignment',  'left');
                        
    % Make cancel, back and finish buttons
    uicontrol(gui.advSelectPanel,...
                     'units',       'normalized',...
                     'position',    [xStart,buttonClearing,Width,Height],...
                     'callback',    @gui.exitGUI,...
                     'String',      'Cancel',...
                     'Style',       'pushbutton');

    uicontrol(gui.advSelectPanel,...
                     'units',       'normalized',...
                     'position',    [xStart + Width + space,buttonClearing,Width,Height],...
                     'callback',    @gui.switchImportPanel,...
                     'String',      'Back',...
                     'Style',       'pushbutton');
                 
    uicontrol(gui.advSelectPanel,...
                     'units',       'normalized',...
                     'position',    [xStart + Width*2 + space*2,buttonClearing,Width,Height],...
                     'callback',    @gui.finishCallback,...
                     'String',      'Finish',...
                     'Style',       'pushbutton');  

    % Update table
    updateTable(gui);
                 
    % Make the GUI visible.
    %--------------------------------------------------------------
    set(gui.figureHandle,'Visible','on');

    
    
end

