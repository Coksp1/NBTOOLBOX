function makeGUI(gui)
% Syntax:
%
% makeGUI(gui)
%
% Description:
%
% Part of DAG.
% 
% Written by Kenneth Sæterhagen Paulsen

% Copyright (c) 2024, Kenneth Sæterhagen Paulsen

    parent = gui.parent;

    % Create the main window
    %--------------------------------------------------------------
    if isa(parent,'nb_GUI')
        name = [parent.guiName ': Principal components'];
    else
        name = 'Principal components';
    end
    
    % Create window
    %--------------------------------------------------------------
    currentMonitor    = nb_getCurrentMonitor();
    defaultBackground = get(0,'defaultUicontrolBackgroundColor');
    f = figure(   'visible',        'off',...
                  'units',          'characters',...
                  'position',       [65,   15,  100,   30],...
                  'Color',          defaultBackground,...
                  'name',           name,...
                  'numberTitle',    'off',...
                  'menuBar',        'None',...
                  'toolBar',        'None',...
                  'resize',         'off',...
                  'windowStyle',    'modal');
    nb_moveFigureToMonitor(f,currentMonitor);
    
    % Locations
    %--------------------------------------------------------------
    ySpace       = 0.04;
    xSpace       = 0.04;
    startY1      = 0.7;
    startY2      = 0.4;
    startY3      = 0.1;
    calcHeight   = ySpace*3;
    listHeight   = 1 - ySpace - startY1;
    listWidth    = 0.4;
    panelWidth   = 1 - ySpace - ySpace;
    panelHeight  = startY1 - ySpace - calcHeight;
    startListX2  = 1 - xSpace - listWidth;
    
    
    % Add the option components
    %----------------------------------------------------------------
    height  = 0.11;
    width   = 0.25;
    space   = 0.035;
    yTop    = 1 - height - space;
    yLevel1 = yTop - height - space;
    yLevel2 = yLevel1 - height - 2*space;
    yLevel3 = yLevel2 - height - space;
    yLevel4 = yLevel3 - height - 2*space;
    yLevel5 = yLevel4 - height - 2*space;
    yLevel6 = yLevel5 - height - 2*space;
    yLevel7 = yLevel6 - height - 2*space;
    yLevel8 = yLevel7 - height - 2*space;
    textStart  = space;
    boxStart   = textStart + width + space;
    textStart2 = boxStart + width + space*2;
    boxStart2  = textStart2 + width + space;
    
    variables = gui.data.variables;
    
    selectionPanel = nb_selectionPanel(f,'Variables',variables,...
        'position1',            [xSpace,startY1,listWidth,listHeight],...
        'position2',            [startListX2,startY1,listWidth,listHeight],...
        'dockType',             'text');
    
    uicontrol(selectionPanel,...
        'title',                'Selected',...
        'background',           [1 1 1]);
    
    optnPanel = uipanel(f,...
        'title',        'Options',...
        'position',     [xSpace,calcHeight,panelWidth,panelHeight],...
        'units',        'normal');
    
    %======================================================================
    % First column
    %======================================================================
    
    % Number of factors
    %-----------------------------
    nFactorsText = uicontrol(optnPanel,...
        'units',                'normal',...
        'position',             [textStart yTop width height],...
        'string',               'Number of factors: ',...
        'style',                'text',...
        'visible',              'on',...
        'horizontalAlignment',  'left');
    
    nFactors = uicontrol(optnPanel,...
        'units',        'normal',...
        'position',     [boxStart, yTop + 0.01, width, height],...
        'string',       int2str(gui.data.numberOfVariables),...
        'visible',      'on',...
        'style',        'edit',...
        'background',   [1 1 1]);
    
    % Number of factors
    %-----------------------------
    criteriaText = uicontrol(optnPanel,...
        'units',                'normal',...
        'position',             [textStart yTop width height],...
        'string',               'Criteria: ',...
        'style',                'text',...
        'visible',              'off',...
        'horizontalAlignment',  'left');
    
    criteria = uicontrol(optnPanel,...
        'units',        'normal',...
        'position',     [boxStart, yTop + 0.01, width, height],...
        'string',       {'1','2','3','4','5','6','7'},...
        'visible',      'off',...
        'style',        'popupmenu',...
        'background',   [1 1 1]);
    
    % Max factors
    %_----------------------------
    uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [textStart yLevel1 width*2 height],...
        'string',                'Max number of factors:',...
        'style',                 'text',...
        'horizontalAlignment',   'left');
    
    maxFactors = uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [boxStart yLevel1 width height],...
        'string',                int2str(gui.data.numberOfVariables),...
        'style',                 'edit',...
        'enable',                'off',...
        'visible',               'on',...
        'background',            [1 1 1],...
        'horizontalAlignment',   'left');
    
    % Transformation
    %-----------------------------
    uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [textStart yLevel2 width*2 height],...
        'string',                'Transformation:',...
        'style',                 'text',...
        'visible',               'on',...
        'horizontalAlignment',   'left');
    
    transformation = uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [boxStart yLevel2+0.01 width height],...
        'visible',               'on',...
        'style',                 'popupmenu',...
        'background',            [1 1 1],...
        'string',                {'None','Demean','Standardize'},...
        'horizontalAlignment',   'left');    
    
    % Output
    %----------------------------------
    uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [textStart yLevel3 width*2 height],...
        'string',                'Output:',...
        'visible',               'on',...
        'style',                 'text',...
        'horizontalAlignment',   'left');
    
    output = uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [boxStart yLevel3 width height],...
        'style',                 'popupmenu',...
        'string',                {'Factors';'Coefficients';'Explained'},...
        'visible',               'on',...
        'background',            [1 1 1],...
        'horizontalAlignment',   'left');
    
    % Start date
    %----------------------------
    uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [textStart yLevel4 width*2 height],...
        'string',                'Start date:',...
        'visible',               'on',...
        'style',                 'text',...
        'horizontalAlignment',   'left');
    
    dat = dates(gui.data);
    startDate = uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [boxStart yLevel4 width height],...
        'style',                 'popupmenu',...
        'visible',               'on',...
        'string',                dat,...
        'background',            [1 1 1],...
        'horizontalAlignment',   'left');
    
    % End date
    %----------------------------
    uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [textStart yLevel5 width*2 height],...
        'string',                'End date:',...
        'visible',               'on',...
        'style',                 'text',...
        'horizontalAlignment',   'left');
    
    endDate = uicontrol(optnPanel,...
        'units',                 'normal',...
        'position',              [boxStart yLevel5 width height],...
        'style',                 'popupmenu',...
        'visible',               'on',...
        'string',                dat,...
        'value',                 length(dat),...
        'background',            [1 1 1],...
        'horizontalAlignment',   'left');
    
    
    %======================================================================
    % New column
    %======================================================================
    
    % Manual/criteria
    %-----------------------------
    uicontrol(optnPanel,...
        'units',                'normal',...
        'position',             [textStart2, yTop, width, height],...
        'string',               'Manual/Criteria: ',...
        'style',                'text',...
        'horizontalAlignment',  'left');
    
    manualButton = uicontrol(optnPanel,...
        'units',        'normal',...
        'position',     [boxStart2, yTop + 0.01, width/4, height],...
        'value',        1,...
        'enable',       'on',...
        'style',        'radiobutton',...
        'callback',     @gui.manualCallback);
    
    %==========================
    % Make calculate buttons
    %==========================
    uicontrol(f,...
        'units',        'normal',...
        'position',     [0.4275,ySpace,0.15,0.06],...
        'string',       'Calculate',...
        'style',        'pushbutton',...
        'callback',     @gui.calculateCallback);
   
    % Assign elements to structure
    components                = struct();
    components.selectionPanel = selectionPanel;
    components.nFactorsText   = nFactorsText;
    components.nFactors       = nFactors;
    components.criteriaText   = criteriaText;
    components.criteria       = criteria;
    components.options        = optnPanel;
    components.maxFactors     = maxFactors;
    components.transformation = transformation;
    components.output         = output;
    components.startDate      = startDate;
    components.endDate        = endDate;
    components.manualButton   = manualButton;
    gui.components            = components;
 
    % Make window visible
    set(f,'visible','on');
    
end

