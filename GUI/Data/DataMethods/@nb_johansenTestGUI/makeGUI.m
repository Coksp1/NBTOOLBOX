function makeGUI(gui)
% Syntax:
%
% makeGUI(gui)
%
% Description:
%
% Part of DAG. Makes the window for Johansen test.
% 
% Written by Eyo Herstad

% Copyright (c) 2021, Kenneth Sæterhagen Paulsen

    % Check if there are enough variables
    if gui.data.numberOfVariables < 2
        nb_errorWindow('Cannot do cointegration test without at least two variables.');
        return
    end
    
    if gui.data.numberOfDatasets > 1
        nb_errorWindow('Cannot do cointegration test on multipaged data.');
        return
    end

    % Create Window
    %--------------------------------------------------------------
    gui.jtestWindow = nb_guiFigure(gui.parent,'Johansen test',[50 40 80 30],'modal','off');

    % Create first layer of panels
    %-------------------------------
    optionsPanel = uipanel(gui.jtestWindow,...
        'title',        '',...
        'units',        'normal',...
        'borderType',   'none',...
        'position',     [0 0 1 1]);
    
    varSelPanel = uipanel(gui.jtestWindow,...
        'title',        '',...
        'units',        'normal',...
        'visible',      'off',...
        'borderType',   'none',...
        'position',     [0 0 1 1]);
    
    % Var selection panel
    %--------------------------------------------------------------
    varSelListBox = uicontrol(varSelPanel,...
        'style',        'listbox',...
        'string',       gui.data.variables,...
        'value',        1:gui.data.numberOfVariables,...
        'max',          2,...
        'units',        'normal',...
        'position',     [0.05, 0.15, 0.9, 0.8]);
    uicontrol(varSelPanel,...
        'style',        'pushbutton',...
        'string',       'Back',...
        'units',        'normal',...
        'callback',     @gui.switchBackCallback,...
        'position',     [0.4 0.05 0.2 0.05]);
    
    % Create Panels
    %--------------------------------------------------------------
    % Positions
    xSpace           = 0.05;
    ySpace           = 0.04;
    panelStart       = 0.12;
    panelWidth       = (1 - ySpace*3)/2;
    panelHeightTot   = 1 - panelStart - ySpace*2;
    rightPanelxStart = 1-xSpace - panelWidth;
    buttonWidth      = 0.2;
    buttonHeight     = 0.05;
    buttonStart1     = 1 - xSpace - buttonWidth;
    buttonStart2     = buttonStart1 - xSpace - buttonWidth;
    panelUpper       = panelStart +  panelHeightTot+0.01;   
    
    lagLengthPanel = uibuttongroup(optionsPanel,...
        'units',                'normal',...
        'title',                'Lag length',...
        'SelectionChangeFcn',   @gui.lagLengthCallback,...
        'position',             [rightPanelxStart, panelUpper - panelHeightTot*2/4, panelWidth, panelHeightTot*2/4]);
    
    determPanel = uibuttongroup(optionsPanel,...
        'units',                'normal',...
        'title',                'Test assumptions',...
        'position',             [xSpace, panelStart, panelWidth, panelHeightTot+0.01]);
    
    addOptionsPanel = uipanel(optionsPanel,...
        'title',                'Other options',...
        'units',                'normal',...
        'position',             [rightPanelxStart, panelStart, panelWidth, panelHeightTot*2/4 - 0.01],...
        'visible',              'on');
    
    % Create buttons
    uicontrol(optionsPanel,...
        'style',        'pushbutton',...
        'units',        'normal',...
        'position',     [buttonStart2/2 - buttonWidth, ySpace, buttonWidth*2, buttonHeight],...
        'string',       'Select Variables',...
        'callback',     @gui.switchToVarSelCallback);
    
    uicontrol(optionsPanel,...
        'style',        'pushbutton',...
        'units',        'normal',...
        'position',     [buttonStart1 ySpace buttonWidth buttonHeight],...
        'string',       'Cancel',...
        'callback',      @gui.exit);
    
    uicontrol(optionsPanel,...
        'style',        'pushbutton',...
        'units',        'normal',...
        'position',     [buttonStart2 ySpace buttonWidth buttonHeight],...
        'string',       'OK',...
        'callback',      @gui.okCallback);
    
    % Populate panels/buttongroups
    %------------------------------------------------------------
       
    % Lag panel
    lagBtnHeight = 0.15;
    laxBoxheight = 0.12;
    rButtonWidth = 0.8;
    spaceY       = 0.06;
    boxStart     = 0.7;
    boxWidth     = 1 - rButtonWidth;
    yLevel1      = 1 - lagBtnHeight-0.02;
    yLevel2      = yLevel1 - lagBtnHeight - spaceY;
    yLevel3      = yLevel2 - lagBtnHeight - spaceY;
    
    % Lag length panel
    %--------------------
    criteriaList = {'Akaike information criterion';...
        'Modified Akaike information criterion';...
        'Schwarz information criterion';...
        'Modified Schwarz information criterion';...
        'Hannan-Quinn information criterion';...
        'Modified Hannan-Quinn information criterion'...
        };
    
    autSelectBtn = uicontrol(lagLengthPanel,...
        'style',                'radiobutton',...
        'string',               'Automatic selection',...
        'units',                'normal',...
        'position',             [xSpace yLevel1 rButtonWidth lagBtnHeight]);
    criterionBox = uicontrol(lagLengthPanel,...
        'style',                'popupmenu',...
        'background',           [1 1 1],...
        'string',               criteriaList,...
        'units',                'normal',...
        'position',             [xSpace yLevel2 rButtonWidth lagBtnHeight]);
    maxText = uicontrol(lagLengthPanel,...
        'style',                'text',...
        'string',               'Maximum: ',...
        'horizontalAlignment',  'left',...
        'units',                'normal',...
        'position',             [xSpace+0.1 yLevel3 rButtonWidth laxBoxheight]);
    maxLagLengthBox = uicontrol(lagLengthPanel,...
        'style',                'edit',...
        'string',               '5',...
        'units',                'normal',...
        'background',           [1 1 1],...
        'position',             [boxStart yLevel3+0.01 boxWidth laxBoxheight]);
    userSelectBtn = uicontrol(lagLengthPanel,...
        'style',                'radiobutton',...
        'string',               'User specified: ',...
        'units',                'normal',...
        'position',             [xSpace spaceY rButtonWidth lagBtnHeight]);
    userLagSelect = uicontrol(lagLengthPanel,...
        'style',                'edit',...
        'string',               '2',...
        'units',                'normal',...
        'enable',               'off',...
        'background',           [1 1 1],...
        'position',             [boxStart spaceY+0.01 boxWidth laxBoxheight]);
    
    % Deterministic assumptions panel
    %----------------------------------------------------------------
    height = 0.05;
    space = 0.04;
    y1 = 1 - height - space;
    y2 = y1 - height - space;
    y3 = y2 - height - space;
    y4 = y3 - height - 3*space;
    y5 = y4 - height - space;
    y6 = y5 - height - space;
    y7 = y6 - height - 3*space;
    y8 = y7 - height - space;
    
    uicontrol(determPanel,...
        'style',                'text',...
        'string',               'No trend in data.',...
        'units',                'normal',...
        'horizontalAlignment',  'left',...
        'position',             [xSpace y1 rButtonWidth height]);
    btn1 = uicontrol(determPanel,...
        'style',                'radiobutton',...
        'string',               'No intercept in CI',...
        'units',                'normal',...
        'horizontalAlignment',  'left',...
        'string',               'No intercept in CI',...
        'position',             [xSpace y2 0.9 height]);
    
    
    btn2 = uicontrol(determPanel,...
        'style',                'radiobutton',...
        'units',                'normal',...
        'string',               'Intercept in cointegration',...
        'horizontalAlignment',  'left',...
        'position',             [xSpace y3 rButtonWidth height]);
    
    
    uicontrol(determPanel,...
        'style',                'text',...
        'string',               'Trend in data.',...
        'units',                'normal',...
        'horizontalAlignment',  'left',...
        'position',             [xSpace y4 rButtonWidth height]);
    btn3 = uicontrol(determPanel,...
        'style',                'radiobutton',...
        'string',               'Intercept in CI',...
        'units',                'normal',...
        'horizontalAlignment',  'left',...
        'position',             [xSpace y5 rButtonWidth height]);
    btn4 = uicontrol(determPanel,...
        'style',                'radiobutton',...
        'units',                'normal',...
        'string',               'Intercept and trend in CI.',...
        'horizontalAlignment',  'left',...
        'position',             [xSpace y6 rButtonWidth height]);
    
    
    
    uicontrol(determPanel,...
        'style',                'text',...
        'string',               'Linear and quadratic trend in data.',...
        'units',                'normal',...
        'horizontalAlignment',  'left',...
        'max',                  2,...
        'position',             [xSpace y7 rButtonWidth 2*height]);
    btn5 = uicontrol(determPanel,...
        'style',                'radiobutton',...
        'units',                'normal',...
        'string',               'Intercept and trend in CI.',...
        'horizontalAlignment',  'left',...
        'position',             [xSpace y8 rButtonWidth height]);
    
    
    % Additional options panel
    seasonal = {'No seasonal dummies','Centered seasonal dummies','Uncentered seasonal dummies'};
    height = 0.2;
    space  = 0.04;
    
    tests = {'Trace';'Max Eigenvalue'};
    uicontrol(addOptionsPanel,...
        'style',                'text',...
        'string',               'Test',...
        'horizontalAlignment',  'left',...
        'units',                'normal',...
        'position',             [0.05 1-height-space 0.3 height-0.05]);
    testBox = uicontrol(addOptionsPanel,...
        'style',                'popupmenu',...
        'string',               tests,...
        'units',                'normal',...
        'background',           [1 1 1],...
        'position',             [0.32 1-height-space 0.63 height]);
    
    datesList = dates(gui.data);
    uicontrol(addOptionsPanel,...
        'style',                'text',...
        'string',               'Start',...
        'horizontalAlignment',  'left',...
        'units',                'normal',...
        'position',             [0.05, 1-height*2-space*2, 0.3, height-0.05]);
    startDate = uicontrol(addOptionsPanel,...
        'style',                'popupmenu',...
        'string',               datesList,...
        'max',                  1,...
        'units',                'normal',...
        'background',           [1 1 1],...
        'position',             [0.32, 1-height*2-space*2, 0.63, height]);
    
    uicontrol(addOptionsPanel,...
        'style',                'text',...
        'string',               'End',...
        'horizontalAlignment',  'left',...
        'units',                'normal',...
        'position',             [0.05, 1-height*3-space*3, 0.3, height-0.05]);
    endDate = uicontrol(addOptionsPanel,...
        'style',                'popupmenu',...
        'string',               flipud(datesList),...
        'max',                  1,...
        'units',                'normal',...
        'background',           [1 1 1],...
        'position',             [0.32, 1-height*3-space*3, 0.63, height]);
    
    seasonalBox = uicontrol(addOptionsPanel,...
        'style',                'popupmenu',...
        'string',               seasonal,...
        'units',                'normal',...
        'enable',               'off',...
        'background',           [1 1 1],...
        'position',             [0.05 1-4*height-4*space 0.9 height]);
    
    % Assign components to structures
    %---------------------------------------------------------------
    gui.panels.optionsPanel     = optionsPanel;
    gui.panels.varSelPanel      = varSelPanel;
    
    gui.varSelPanelComponents.varSelListBox = varSelListBox;
    
    gui.optionPanelComponents.testBox       = testBox;
    gui.optionPanelComponents.seasonalBox   = seasonalBox;
    gui.optionPanelComponents.startDate     = startDate;
    gui.optionPanelComponents.endDate       = endDate;
    
    gui.determPanelComponents.btn1          = btn1;
    gui.determPanelComponents.btn2          = btn2;
    gui.determPanelComponents.btn3          = btn3;
    gui.determPanelComponents.btn4          = btn4;
    gui.determPanelComponents.btn5          = btn5;
    
    gui.lagPanelComponents.autSelectBtn     = autSelectBtn;
    gui.lagPanelComponents.criterionBox     = criterionBox;
    gui.lagPanelComponents.maxText          = maxText; 
    gui.lagPanelComponents.maxLagLengthBox  = maxLagLengthBox;
    gui.lagPanelComponents.userSelectBtn    = userSelectBtn;
    gui.lagPanelComponents.userLagSelect    = userLagSelect;
    
    % Make the GUI visible.
    %--------------------------------------------------------------
    set(gui.jtestWindow,'Visible','on');
    
end

