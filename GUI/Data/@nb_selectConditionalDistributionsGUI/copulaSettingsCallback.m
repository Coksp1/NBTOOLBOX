function copulaSettingsCallback(gui,~,~)
% Syntax:
%
% copulaSettingsCallback(gui,hObject,event)
%
% Description:
%
% Part of DAG.
% 
% Written by Henrik Halvorsen Hortemo and Kenneth Sæterhagen Paulsen

% Copyright (c) 2021, Kenneth Sæterhagen Paulsen

    % Figure
    currentMonitor    = nb_getCurrentMonitor();
    defaultBackground = get(0, 'defaultUicontrolBackgroundColor');
    gui.figureHandle2 = figure(...
        'visible',        'off',...
        'units',          'characters',...
        'position',       [40   15  160   50],...
        'Color',          defaultBackground,...
        'name',           'Select distributions to condition on',...
        'numberTitle',    'off',...
        'menuBar',        'None',...
        'windowStyle',    'modal',...
        'toolBar',        'None',...
        'resize',         'on');          
    nb_moveFigureToMonitor(gui.figureHandle2, currentMonitor, 'center');

    % 
    startTX    = 0.04;
    startPopX  = 0.25;
    widthPop   = 0.3;
    startPopX2 = startPopX + widthPop + startTX;
    heightPop  = 0.045;
    widthT     = startPopX - startTX*2;
    heightT    = 0.04;
    kk         = 14; 
    spaceYPop  = (1 - heightPop*kk)/(kk + 1);
    extra      = -(heightPop - heightT);
    
    uicontrol(...
              'units',                  'normalized',...
              'position',               [startTX, heightPop*(kk-1) + spaceYPop*kk + extra*0.6, widthT, heightT],...
              'parent',                 gui.figureHandle2,...
              'style',                  'text',...
              'horizontalAlignment',    'left',...
              'string',                 'Autocorrelation option');

    gui.covarianceOption = uicontrol(...
          'units',          'normalized',...
          'position',       [startPopX, heightPop*(kk-1) + spaceYPop*kk, widthPop, heightPop],...
          'parent',         gui.figureHandle2,...
          'background',     [1 1 1],...
          'style',          'popupmenu',...
          'string',         {'Theoretical','Empirical'},...
          'value',          1);
    
    uicontrol(...
          'units',          'normalized',...
          'position',       [startPopX2, heightPop*(kk-1) + spaceYPop*kk + 0.013, widthPop, heightPop*0.8],...
          'parent',         gui.figureHandle2,...
          'style',          'pushbutton',...
          'Interruptible',  'off',...
          'string',         'Calculate',...
          'callback',       @gui.momentsCallback);  
      
    % Number of lags
%     kk = kk - 1;
%     uicontrol(...
%               'units',                  'normalized',...
%               'position',               [startTX, heightPop*(kk-1) + spaceYPop*kk + extra*0.6, widthT, heightT],...
%               'parent',                 gui.figureHandle2,...
%               'style',                  'text',...
%               'horizontalAlignment',    'left',...
%               'string',                 'Number of lags');  
%       
%     lags = 0:length(gui.dates);
%     lags = strtrim(cellstr(int2str(lags')));
%     gui.lagsOption = uicontrol(...
%           'units',          'normalized',...
%           'position',       [startPopX, heightPop*(kk-1) + spaceYPop*kk, widthPop, heightPop],...
%           'parent',         gui.figureHandle2,...
%           'background',     [1 1 1],...
%           'style',          'popupmenu',...
%           'string',         lags,...
%           'value',          length(lags));      
          
    % Number of init period
    kk = kk - 1;
    uicontrol(...
              'units',                  'normalized',...
              'position',               [startTX, heightPop*(kk-1) + spaceYPop*kk + extra*0.6, widthT, heightT],...
              'parent',                 gui.figureHandle2,...
              'style',                  'text',...
              'horizontalAlignment',    'left',...
              'string',                 'Initial periods');  
      
    periods = 0:max(10,gui.initPeriods);
    value   = find(gui.initPeriods == periods,1);
    periods = strtrim(cellstr(int2str(periods')));
    gui.initPeriodsOption = uicontrol(...
          'units',          'normalized',...
          'position',       [startPopX, heightPop*(kk-1) + spaceYPop*kk, widthPop, heightPop],...
          'parent',         gui.figureHandle2,...
          'background',     [1 1 1],...
          'style',          'popupmenu',...
          'string',         periods,...
          'value',          value);  
      
    % Create table
    gui.tableHandle2 = nb_uitable(...
        'columnNamesOnly',  true,...
        'Parent',           gui.figureHandle2, ...
        'Units',            'normalized', ...
        'Position',         [0, 0, 1, 0.8]);
    
    if isa(gui.sigma,'nb_cs')
        set(gui.tableHandle2, ...
        'ColumnName',   gui.sigma.variables, ...
        'RowName',      gui.sigma.types, ...
        'Data',         gui.sigma.data);
    end
    
    % Create window
    set(gui.figureHandle2,'visible','on');

end
